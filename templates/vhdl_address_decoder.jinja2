-- Automatically generated by WhishList - https://github.com/mvsoliveira/wishlist/
-- Package name: {{ name }}_pkg
-- Description : {{ description }}

library ieee;
use ieee.std_logic_1164.all;
library work;
use work.{{ name }}_pkg.all;

entity {{ name }}_address_decoder is
port(
    clk_i : in std_logic;
    read_i : in std_logic;
    write_i : in std_logic;
    data_i : in std_logic_vector({{ address_width-1 }} downto 0);
    data_o : out std_logic_vector({{ address_width-1 }} downto 0)
);
end entity {{ name }}_address_decoder;


architecture rtl of {{ name }}_address_decoder is

signal {{ name }}_control_int : {{ name }}_control_record_type;
signal {{ name }}_status_int : {{ name }}_status_record_type;

begin

{{ name }}_control_int <= {{ name }}_control_int;
{{ name }}_status <= {{ name }}_status_int;

address_decoder_p : process (clk_i) is
begin
    if rising_edge(clk_i) then
{#- Iterating status and control registers #}
{%- for permission_regex, direction, strobe in (('^rw?$','status','read'),('^r$','control','write')) %}
        if ({{ strobe }}_i = '1') then
            case address_i is
    {%- set df = address_decoder[address_decoder.permission.str.match(permission_regex)] %}
    {%- for address in np.sort(df.address.unique()) %}
                when X"{{ get_address_string(address) }}" =>
        {%- for i, row in df[df.address==address].iterrows() %}
                {%- if direction == 'control' %}
                    {{ get_signal_name(row['name'], row['permission']) }}({{ get_vhdl_bit_string(row.register_bits_lists) }}) <= data_i({{ get_vhdl_bit_string(row.address_bits_lists) }});
            {%- else %}
                    data_o({{ get_vhdl_bit_string(row.address_bits_lists) }}) <= {{ get_signal_name(row['name'], row['permission']) }}({{ get_vhdl_bit_string(row.register_bits_lists) }});
            {%- endif %}
        {%- endfor %}
    {%- endfor %}
                when others => null;
            end case;
        end if;
{%- endfor %}
    end if;
end process address_decoder_p;

end architecture rtl;